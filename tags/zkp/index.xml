<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Zkp on Kevin He&#39;s Website</title>
        <link>https://kevinhe.io/tags/zkp/</link>
        <description>Recent content in Zkp on Kevin He&#39;s Website</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Tue, 09 Feb 2021 20:02:00 +0000</lastBuildDate><atom:link href="https://kevinhe.io/tags/zkp/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>zksync 存储：sparse-merkle-tree 存储</title>
            <link>https://kevinhe.io/sparse-merkle-tree/</link>
            <pubDate>Tue, 09 Feb 2021 20:02:00 +0000</pubDate>
            <guid>https://kevinhe.io/sparse-merkle-tree/</guid>
            <description>&lt;img src=&#34;https://kevinhe.io/&#34; alt=&#34;Featured image of post zksync 存储：sparse-merkle-tree 存储&#34; /&gt;&lt;h1 id=&#34;简介&#34;&gt;&lt;a href=&#34;#%e7%ae%80%e4%bb%8b&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;简介&#xA;&lt;/h1&gt;&lt;p&gt;本文先介绍了 sparse merkle tree，接下来介绍 zksync 中数据持久化。&lt;/p&gt;&#xA;&lt;h1 id=&#34;merkle-tree&#34;&gt;&lt;a href=&#34;#merkle-tree&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;merkle tree&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Merkle_tree&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;merkle tree&lt;/a&gt; 常用于区块链存储数据和快速校验数据。其构造特点是叶节点使用数据的 hash 进行标记，中间节点使用所有子节点的 hash进行标记。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://kevinhe.io/sparse-merkle-tree/merkle-tree.png&#34;&#xA;&#x9;width=&#34;602&#34;&#xA;&#x9;height=&#34;602&#34;&#xA;&#x9;loading=&#34;lazy&#34;&#xA;&#x9;&#xA;&#x9;&#x9;alt=&#34;merkle-tree&#34;&#xA;&#x9;&#xA;    &#xA;&#x9;&#xA;&#x9;&#x9;class=&#34;gallery-image&#34; &#xA;&#x9;&#x9;data-flex-grow=&#34;100&#34;&#xA;&#x9;&#x9;data-flex-basis=&#34;240px&#34;&#xA;&#x9;&#xA;&gt;&lt;/p&gt;&#xA;&lt;p&gt;对于 merke tree 的操作，包含：插入节点、获取树根、计算 merkle 证明、检验 merkle 证明。&lt;/p&gt;&#xA;&lt;p&gt;计算 merkle 证明包含：&lt;/p&gt;&#xA;&lt;p&gt;1）计算存在证明&lt;/p&gt;&#xA;&lt;p&gt;2）计算不存在证明&lt;/p&gt;&#xA;&lt;p&gt;在原始的 merkle tree 上，很容易生成存在性证明，但是难以生成不存在证明。&lt;/p&gt;&#xA;&lt;h1 id=&#34;sparse-merkle-tree&#34;&gt;&lt;a href=&#34;#sparse-merkle-tree&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;sparse merkle tree&#xA;&lt;/h1&gt;&lt;p&gt;为了解决这个问题，同时零知识证明也要求账号在树上的位置具有确定性，因此引入 sparse merkle tree，有如下特点：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;一棵满二叉树&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;数据是索引的，每个数据会放到对应的索引的叶子上&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;存在性证明，merkle path&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;不存在性证明，需要证明是 null&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h1 id=&#34;优化&#34;&gt;&lt;a href=&#34;#%e4%bc%98%e5%8c%96&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;优化&#xA;&lt;/h1&gt;&lt;p&gt;1）预计算空值哈希&lt;/p&gt;&#xA;&lt;p&gt;由于大部分情况下，树并不会真的满，而是非常的稀疏。可以预计算H(null)、H(H(null)|H(null))、H(H(H(null)|H(null))|H(H(null)|H(null)))等层级上的值，达到加速的效果。&lt;/p&gt;&#xA;&lt;p&gt;2）并行计算左右子树哈希&lt;/p&gt;&#xA;&lt;p&gt;H(H(left)|H(right)) 这类操作要求 快速计算左右子树的哈希值，并行计算可以计算。&lt;/p&gt;&#xA;&lt;h1 id=&#34;实现&#34;&gt;&lt;a href=&#34;#%e5%ae%9e%e7%8e%b0&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;实现&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/matter-labs/zksync/blob/master/core/lib/crypto/src/merkle_tree/parallel_smt.rs&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;rust-matter-labs&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/iden3/iden3js/blob/master/src/sparse-merkle-tree/sparse-merkle-tree.js&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;js-iden3&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/iden3/go-iden3-core/blob/master/merkletree/merkletree.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;golang-iden3&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;文献参考&#34;&gt;&lt;a href=&#34;#%e6%96%87%e7%8c%ae%e5%8f%82%e8%80%83&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;文献参考&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://medium.com/@kelvinfichter/whats-a-sparse-merkle-tree-acda70aeb837&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;whats-a-sparse-merkle-tree&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.iden3.io/sparse-merkle-trees-visual-introduction.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;sparse-merkle-trees-visual-introduction&lt;/a&gt;&lt;/p&gt;&#xA;</description>
        </item></channel>
</rss>
