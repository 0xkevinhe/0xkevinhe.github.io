<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Code on Kevin He&#39;s Website</title>
        <link>https://kevinhe.io/categories/code/</link>
        <description>Recent content in Code on Kevin He&#39;s Website</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Tue, 09 Feb 2021 20:02:00 +0000</lastBuildDate><atom:link href="https://kevinhe.io/categories/code/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>zksync 存储：sparse-merkle-tree 存储</title>
            <link>https://kevinhe.io/sparse-merkle-tree/</link>
            <pubDate>Tue, 09 Feb 2021 20:02:00 +0000</pubDate>
            <guid>https://kevinhe.io/sparse-merkle-tree/</guid>
            <description>&lt;img src=&#34;https://kevinhe.io/sparse-merkle-tree/cover.jpg&#34; alt=&#34;Featured image of post zksync 存储：sparse-merkle-tree 存储&#34; /&gt;&lt;h1 id=&#34;简介&#34;&gt;&lt;a href=&#34;#%e7%ae%80%e4%bb%8b&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;简介&#xA;&lt;/h1&gt;&lt;p&gt;本文先介绍了 sparse merkle tree，接下来介绍 zksync 中数据持久化。&lt;/p&gt;&#xA;&lt;h1 id=&#34;merkle-tree&#34;&gt;&lt;a href=&#34;#merkle-tree&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;merkle tree&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Merkle_tree&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;merkle tree&lt;/a&gt; 常用于区块链存储数据和快速校验数据。其构造特点是叶节点使用数据的 hash 进行标记，中间节点使用所有子节点的 hash进行标记。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://kevinhe.io/sparse-merkle-tree/merkle-tree.png&#34;&#xA;&#x9;width=&#34;602&#34;&#xA;&#x9;height=&#34;602&#34;&#xA;&#x9;loading=&#34;lazy&#34;&#xA;&#x9;&#xA;&#x9;&#x9;alt=&#34;merkle-tree&#34;&#xA;&#x9;&#xA;    &#xA;&#x9;&#xA;&#x9;&#x9;class=&#34;gallery-image&#34; &#xA;&#x9;&#x9;data-flex-grow=&#34;100&#34;&#xA;&#x9;&#x9;data-flex-basis=&#34;240px&#34;&#xA;&#x9;&#xA;&gt;&lt;/p&gt;&#xA;&lt;p&gt;对于 merke tree 的操作，包含：插入节点、获取树根、计算 merkle 证明、检验 merkle 证明。&lt;/p&gt;&#xA;&lt;p&gt;计算 merkle 证明包含：&lt;/p&gt;&#xA;&lt;p&gt;1）计算存在证明&lt;/p&gt;&#xA;&lt;p&gt;2）计算不存在证明&lt;/p&gt;&#xA;&lt;p&gt;在原始的 merkle tree 上，很容易生成存在性证明，但是难以生成不存在证明。&lt;/p&gt;&#xA;&lt;h1 id=&#34;sparse-merkle-tree&#34;&gt;&lt;a href=&#34;#sparse-merkle-tree&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;sparse merkle tree&#xA;&lt;/h1&gt;&lt;p&gt;为了解决这个问题，同时零知识证明也要求账号在树上的位置具有确定性，因此引入 sparse merkle tree，有如下特点：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;一棵满二叉树&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;数据是索引的，每个数据会放到对应的索引的叶子上&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;存在性证明，merkle path&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;不存在性证明，需要证明是 null&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h1 id=&#34;优化&#34;&gt;&lt;a href=&#34;#%e4%bc%98%e5%8c%96&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;优化&#xA;&lt;/h1&gt;&lt;p&gt;1）预计算空值哈希&lt;/p&gt;&#xA;&lt;p&gt;由于大部分情况下，树并不会真的满，而是非常的稀疏。可以预计算H(null)、H(H(null)|H(null))、H(H(H(null)|H(null))|H(H(null)|H(null)))等层级上的值，达到加速的效果。&lt;/p&gt;&#xA;&lt;p&gt;2）并行计算左右子树哈希&lt;/p&gt;&#xA;&lt;p&gt;H(H(left)|H(right)) 这类操作要求 快速计算左右子树的哈希值，并行计算可以计算。&lt;/p&gt;&#xA;&lt;h1 id=&#34;实现&#34;&gt;&lt;a href=&#34;#%e5%ae%9e%e7%8e%b0&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;实现&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/matter-labs/zksync/blob/master/core/lib/crypto/src/merkle_tree/parallel_smt.rs&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;rust-matter-labs&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/iden3/iden3js/blob/master/src/sparse-merkle-tree/sparse-merkle-tree.js&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;js-iden3&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/iden3/go-iden3-core/blob/master/merkletree/merkletree.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;golang-iden3&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;文献参考&#34;&gt;&lt;a href=&#34;#%e6%96%87%e7%8c%ae%e5%8f%82%e8%80%83&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;文献参考&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://medium.com/@kelvinfichter/whats-a-sparse-merkle-tree-acda70aeb837&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;whats-a-sparse-merkle-tree&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.iden3.io/sparse-merkle-trees-visual-introduction.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;sparse-merkle-trees-visual-introduction&lt;/a&gt;&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>Spring Cloud 配置中心</title>
            <link>https://kevinhe.io/spring-cloud-config/</link>
            <pubDate>Fri, 13 Oct 2017 23:18:16 +0000</pubDate>
            <guid>https://kevinhe.io/spring-cloud-config/</guid>
            <description>&lt;img src=&#34;https://kevinhe.io/spring-cloud-config/cover.jpg&#34; alt=&#34;Featured image of post Spring Cloud 配置中心&#34; /&gt;&lt;h1 id=&#34;闲话配置&#34;&gt;&lt;a href=&#34;#%e9%97%b2%e8%af%9d%e9%85%8d%e7%bd%ae&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;闲话配置&#xA;&lt;/h1&gt;&lt;p&gt;老司机都喜欢在程序设计中尽可能的把各种参数做成可配置的，等到产品需求发生改动的时候，优雅的修改一行配置，重新加载一次配置，就满足了需求。&lt;/p&gt;&#xA;&#xA;    &lt;blockquote&gt;&#xA;        &lt;p&gt;配置（Configuration）是不修改代码的情况下，对程序的运行调整的能力。&lt;/p&gt;&#xA;&#xA;    &lt;/blockquote&gt;&#xA;&lt;p&gt;简单来讲，配置可以分成两类：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;系统配置：包括线程池大小、数据库连接等，变化频率较低&lt;/li&gt;&#xA;&lt;li&gt;业务配置：功能开关，功能参数等，变化较为频繁&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;程序的配置一般而言，分为几个环境：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;开发环境&lt;/li&gt;&#xA;&lt;li&gt;测试环境&lt;/li&gt;&#xA;&lt;li&gt;生产环境&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;这几个环境的配置是有差异的，所以配置管理功能应当能够根据当前环境读取对应的配置。&lt;/p&gt;&#xA;&lt;p&gt;前面提到的不修改代码，只是最低要求，相当多的情况下，程序是不能停机的，这就提出了热更新的需求。&lt;/p&gt;&#xA;&lt;p&gt;另外，配置的修改应该是有记录可追溯的。&lt;/p&gt;&#xA;&lt;h1 id=&#34;spring-boot-的配置管理&#34;&gt;&lt;a href=&#34;#spring-boot-%e7%9a%84%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Spring Boot 的配置管理&#xA;&lt;/h1&gt;&lt;p&gt;Spring 实现了非常友好的配置读取方式，&lt;/p&gt;&#xA;&lt;p&gt;Spring Boot 程序默认使用 application.properties 进行配置。&lt;/p&gt;&#xA;&lt;p&gt;例如一个参数：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;flag=0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;在程序中可以通过：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@Value(&amp;#34;${flag})&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;int flag;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;来读取。&lt;/p&gt;&#xA;&lt;p&gt;也可以通过设置多个配置文件：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;application.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;application-dev.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;application-test.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;application-prod.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;application-dev.properties&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;flag=1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;application-test.properties&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;flag=2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;application-prod.properties&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;flag=3&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;和在 application.properties 中声明当前的活跃的 profile：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring.profiles.active=dev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;来实现根据运行环境切换配置信息。&lt;/p&gt;&#xA;&lt;p&gt;以上只是 Spring 强大的配置能力的冰山一角，有兴趣可以参考&lt;a class=&#34;link&#34; href=&#34;https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;外部配置文档&lt;/a&gt;。&lt;/p&gt;&#xA;&lt;h2 id=&#34;这还不够&#34;&gt;&lt;a href=&#34;#%e8%bf%99%e8%bf%98%e4%b8%8d%e5%a4%9f&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;这还不够&#xA;&lt;/h2&gt;&lt;p&gt;其实以上描述的 Spring Boot 的配置能力已经很强了，但是有个很致命的问题——无法热更新。&lt;/p&gt;&#xA;&lt;p&gt;如果非得实现热更新，那可以把配置做成 JSON 文件，再实现一个 endpoint，重新读取一次配置。&lt;/p&gt;&#xA;&lt;p&gt;假设有一千个实例呢？&lt;/p&gt;&#xA;&lt;h1 id=&#34;spring-cloud-config&#34;&gt;&lt;a href=&#34;#spring-cloud-config&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;Spring Cloud Config&#xA;&lt;/h1&gt;&lt;p&gt;项目 github：&lt;a class=&#34;link&#34; href=&#34;https://github.com/spring-cloud/spring-cloud-config&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/spring-cloud/spring-cloud-config&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;简介：External configuration (server and client) for Spring Cloud&lt;/p&gt;&#xA;&lt;p&gt;这个项目包含两部分：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Server&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;负责从 git/svn 等版本管理系统中读取配置，并以 http 的方式提供服务。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Client&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;根据客户端配置，从指定的 Server 中读取对应配置，并且与 Spring 本身的 PropertyResource 和 Environment 无缝结合。同时，提供了统一的方式进行配置热更新。&lt;/p&gt;&#xA;&lt;p&gt;对于这个系统的基础配置和运行，可以参阅下面两个 url：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://spring.io/guides/gs/centralized-configuration/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://spring.io/guides/gs/centralized-configuration/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://blog.didispace.com/spring-cloud-starter-dalston-3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://blog.didispace.com/spring-cloud-starter-dalston-3/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;实操进阶&#34;&gt;&lt;a href=&#34;#%e5%ae%9e%e6%93%8d%e8%bf%9b%e9%98%b6&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;实操进阶&#xA;&lt;/h2&gt;&lt;h3 id=&#34;热更新&#34;&gt;&lt;a href=&#34;#%e7%83%ad%e6%9b%b4%e6%96%b0&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;热更新&#xA;&lt;/h3&gt;&lt;p&gt;Spring Cloud Config 实现了非常优雅的热更新。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;客户端的配置 Bean 添加 @RefreshScope&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@Configuration&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@RefreshScope&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;public class ConsumeConfig {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @Value(&amp;#34;${consume.desc}&amp;#34;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    private String consumeDesc;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @Value(&amp;#34;#{&amp;#39;${api.server.round.card}&amp;#39;.split(&amp;#39;,&amp;#39;)}&amp;#34;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    private List&amp;lt;String&amp;gt; cardList;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;在配置这个注解之后，调用客户端的 /refresh endpoint，这个 Bean 就会刷新，同时个 Bean 的依赖方下次方法调用时也会更新 Bean 引用。&lt;/p&gt;&#xA;&lt;p&gt;有些时候，你需要监听这个更新事件，把拿到的最新配置，重新初始化一些部件。那你可以添加：&#xA;&lt;code&gt;@EventListener(EnvironmentChangeEvent.class)&lt;/code&gt; 这个 annotation。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@Component&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;public class ConsumeService {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @Autowired&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ConsumeConfig consumeConfig;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @EventListener(EnvironmentChangeEvent.class)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    void onEnvChange() {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        //do re-init stuff&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h3 id=&#34;添加权限&#34;&gt;&lt;a href=&#34;#%e6%b7%bb%e5%8a%a0%e6%9d%83%e9%99%90&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;添加权限&#xA;&lt;/h3&gt;&lt;p&gt;Config Server 任何人都可以通过 http 访问配置，这个不大好，建议加上认证，最简单是使用 Spring-Security 添加一个 basic authentication。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;服务器端配置&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;build.gradle 添加依赖：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dependencies {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    compile(&amp;#39;org.springframework.boot:spring-boot-starter-security&amp;#39;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;application.properties 添加密码（用户名默认是 user）：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;security.user.password=xxx&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;重启服务器，再次通过 http 访问配置的时候需要验证。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;客户端配置&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;服务器端做了验证，那客户端也需要添加相应的配置：&lt;/p&gt;&#xA;&lt;p&gt;bootstrap.yml&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; application:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: application&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; cloud:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  config:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   uri: http://yourhost.com&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   profile: dev&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   username: user&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   password: xxx&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h3 id=&#34;加载多组配置文件&#34;&gt;&lt;a href=&#34;#%e5%8a%a0%e8%bd%bd%e5%a4%9a%e7%bb%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;加载多组配置文件&#xA;&lt;/h3&gt;&lt;p&gt;很多时候，为了避免 application.properties 过于臃肿，你可能需要把一些配置文件拆出来，例如专门负责邀请奖励的配置：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invite.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invite-dev.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invite-test.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;invite-prod.properties&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;同样，也区分了多个环境。&lt;/p&gt;&#xA;&lt;p&gt;那在使用 Spring Cloud 的时候如何读取这个文件呢？&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spring:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; application:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: application,invite&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;注意上面的 application.name 是以逗号分隔的两组配置名称。&lt;/p&gt;&#xA;&lt;h1 id=&#34;一些问题&#34;&gt;&lt;a href=&#34;#%e4%b8%80%e4%ba%9b%e9%97%ae%e9%a2%98&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;一些问题&#xA;&lt;/h1&gt;&lt;h2 id=&#34;eventlistener-与-spel&#34;&gt;&lt;a href=&#34;#eventlistener-%e4%b8%8e-spel&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;@EventListener 与 SpEL&#xA;&lt;/h2&gt;&lt;p&gt;我在实际使用中发现，在事件监听函数中，使用更新后的配置的时候：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @Value(&amp;#34;${consume.desc}&amp;#34;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    private String consumeDesc;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    @Value(&amp;#34;#{&amp;#39;${api.server.round.card}&amp;#39;.split(&amp;#39;,&amp;#39;)}&amp;#34;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    private List&amp;lt;String&amp;gt; cardList;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;第一个配置是使用 @Value 绑定一个字符串类型，第二个配置是使用 @Value 中的 SpEL 去将配置中的字符串，切割成 List。&lt;/p&gt;&#xA;&lt;p&gt;我发现第二个，无法切割成功。试验了多次，还没有找到答案。我已经在 Spring Cloud Config 的 github 上提交了 &lt;a class=&#34;link&#34; href=&#34;https://github.com/spring-cloud/spring-cloud-config/issues/821&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;issue&lt;/a&gt;。&lt;/p&gt;&#xA;&lt;p&gt;如果有了解这个的，请不吝赐教。&lt;/p&gt;&#xA;&#xA;    &lt;blockquote&gt;&#xA;        &lt;p&gt;update 2017-10-26&lt;/p&gt;&#xA;&#xA;    &lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;我在 github 上提交了 issue： &lt;a class=&#34;link&#34; href=&#34;https://github.com/spring-cloud/spring-cloud-config/issues/821&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/spring-cloud/spring-cloud-config/issues/821&lt;/a&gt; 得到回复：&lt;code&gt;We have only ever documented that placeholders ${} work, not SpEL.&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;权限管理&#34;&gt;&lt;a href=&#34;#%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;权限管理&#xA;&lt;/h2&gt;&lt;p&gt;在不做二次开发的情况下，这个配置中心的数据是对所有的 client 开放的。某些情况下，这种设定并不合适。&lt;/p&gt;&#xA;&lt;h2 id=&#34;json-文件的读取和解析&#34;&gt;&lt;a href=&#34;#json-%e6%96%87%e4%bb%b6%e7%9a%84%e8%af%bb%e5%8f%96%e5%92%8c%e8%a7%a3%e6%9e%90&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;JSON 文件的读取和解析&#xA;&lt;/h2&gt;&lt;p&gt;Spring Cloud Config 本身是可以通过 http 来提供 JSON 文件的访问的，但是Spring Boot 原生并不支持 JSON 配置的读取和解析。&lt;/p&gt;&#xA;&lt;h1 id=&#34;相关选择&#34;&gt;&lt;a href=&#34;#%e7%9b%b8%e5%85%b3%e9%80%89%e6%8b%a9&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;相关选择&#xA;&lt;/h1&gt;&lt;p&gt;其实配置管理工具，选择还是不少的，下面列举一下。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;owner &lt;a class=&#34;link&#34; href=&#34;http://owner.aeonbits.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://owner.aeonbits.org/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;配置文件管理，可以热更新，跟 Spring 没有绑定。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;cfg4j &lt;a class=&#34;link&#34; href=&#34;http://www.cfg4j.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://www.cfg4j.org/&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;专注管理配置文件，也可以实现热更，跟 Spring 没有绑定。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;applolo &lt;a class=&#34;link&#34; href=&#34;https://github.com/ctripcorp/apollo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/ctripcorp/apollo&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;携程开源的，功能很全&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;disconf &lt;a class=&#34;link&#34; href=&#34;https://github.com/knightliao/disconf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/knightliao/disconf&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;百度的一位工程师的开源项目，功能也很全&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;diamond &lt;a class=&#34;link&#34; href=&#34;https://github.com/takeseem/diamond&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/takeseem/diamond&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;来自阿里的开源，有些日子了&lt;/p&gt;&#xA;&lt;h1 id=&#34;参考文献&#34;&gt;&lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;参考文献&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://blog.didispace.com/spring-cloud-starter-dalston-3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://blog.didispace.com/spring-cloud-starter-dalston-3/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://cloud.spring.io/spring-cloud-config/single/spring-cloud-config.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://cloud.spring.io/spring-cloud-config/single/spring-cloud-config.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://jm.taobao.org/2016/09/28/an-article-about-config-center/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://jm.taobao.org/2016/09/28/an-article-about-config-center/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.coding.net/blog/spring-cloud-config&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://blog.coding.net/blog/spring-cloud-config&lt;/a&gt;&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>如何更好的提出技术问题</title>
            <link>https://kevinhe.io/a-good-question/</link>
            <pubDate>Wed, 03 Feb 2016 11:18:16 +0000</pubDate>
            <guid>https://kevinhe.io/a-good-question/</guid>
            <description>&lt;img src=&#34;https://kevinhe.io/a-good-question/cover.jpg&#34; alt=&#34;Featured image of post 如何更好的提出技术问题&#34; /&gt;&lt;p&gt;下面咱们就来聊聊技术人的素养：如何更好的提出技术问题。&#xA;笔者从事 &lt;a class=&#34;link&#34; href=&#34;https://bugtags.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;Bugtags.com&lt;/a&gt; 开发运营以来，除了开发任务以外，最重要的工作就是在 qq 群里面回答用户的问题。&lt;/p&gt;&#xA;&lt;p&gt;这半年来，少说也接待了上千个用户了。笔者发现，有相当一部分的用户，提问方式和技巧都有问题，这样导致了我们额外的客服量，也使得自己的问题得不到及时满意的回答。&lt;/p&gt;&#xA;&lt;p&gt;下面咱们就来聊聊技术人的素养：如何更好的提出技术问题。&lt;/p&gt;&#xA;&lt;h1 id=&#34;直接了当&#34;&gt;&lt;a href=&#34;#%e7%9b%b4%e6%8e%a5%e4%ba%86%e5%bd%93&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;直接了当&#xA;&lt;/h1&gt;&lt;p&gt;有的用户，喜欢先问：『有人在吗？』&lt;/p&gt;&#xA;&lt;p&gt;其实这个问句真的是很无意义，有问题直接提出来就好，有工作人员或者热心人看到了，能回答的自然就会回答，为什么还需要问有没有人在家呢？&lt;/p&gt;&#xA;&lt;h1 id=&#34;目的明确&#34;&gt;&lt;a href=&#34;#%e7%9b%ae%e7%9a%84%e6%98%8e%e7%a1%ae&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;目的明确&#xA;&lt;/h1&gt;&lt;p&gt;有的用户，其实只是对某些技术点感兴趣，但是表现出来，是要给我们反馈 bug。这样我们就很摸不着头脑。&lt;/p&gt;&#xA;&lt;p&gt;是吐槽、建议、反馈、赞扬还是学习？请一上来就说明。&lt;/p&gt;&#xA;&lt;h1 id=&#34;有价值&#34;&gt;&lt;a href=&#34;#%e6%9c%89%e4%bb%b7%e5%80%bc&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;有价值&#xA;&lt;/h1&gt;&lt;p&gt;列举一些个人认为没有价值的问题：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;PHP 是不是最好的语言？&lt;/li&gt;&#xA;&lt;li&gt;VIM 还是 Emacs 好？&lt;/li&gt;&#xA;&lt;li&gt;学 Android 有没有前途？&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;这种问题，没有讨论的价值。&lt;/p&gt;&#xA;&lt;h1 id=&#34;已尝试求解&#34;&gt;&lt;a href=&#34;#%e5%b7%b2%e5%b0%9d%e8%af%95%e6%b1%82%e8%a7%a3&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;已尝试求解&#xA;&lt;/h1&gt;&lt;p&gt;其实大部分我们遇到的技术问题，只要在谷歌或者百度上查找，大多能找到答案。&lt;/p&gt;&#xA;&lt;p&gt;大部分情况下，使用 Bugtags 遇到的问题，都能通过我们的帮助文档解决。&lt;/p&gt;&#xA;&lt;p&gt;但是我发现中国人真的很着急，文档也不看，帮助也不看，上来就问。&lt;/p&gt;&#xA;&lt;h1 id=&#34;问题着眼点小&#34;&gt;&lt;a href=&#34;#%e9%97%ae%e9%a2%98%e7%9d%80%e7%9c%bc%e7%82%b9%e5%b0%8f&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;问题着眼点小&#xA;&lt;/h1&gt;&lt;p&gt;切忌提一些特别大的问题，例如『安卓如何管理内存』，这种是需要一些列文章才能阐述清楚的问题，显然是不适合在 QQ 群上提问的。&lt;/p&gt;&#xA;&lt;h1 id=&#34;背景信息充足&#34;&gt;&lt;a href=&#34;#%e8%83%8c%e6%99%af%e4%bf%a1%e6%81%af%e5%85%85%e8%b6%b3&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;背景信息充足&#xA;&lt;/h1&gt;&lt;p&gt;举个例子，Bugtags SDK 支持 Android 和 iOS，但是大部分用户提问的时候，会忽略了这个信息。同样，常用的操作系统，也有 OSX 和 Windows，很多人也会忽略。&lt;/p&gt;&#xA;&lt;p&gt;这里面其实有个思维盲点，提出问题的人，会忽略一些显而易见的环境差异，认为别人了解背景信息，具有跟他一样的运行环境和操作步骤。&lt;/p&gt;&#xA;&lt;h1 id=&#34;问题描述信息充分&#34;&gt;&lt;a href=&#34;#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0%e4%bf%a1%e6%81%af%e5%85%85%e5%88%86&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;问题描述信息充分&#xA;&lt;/h1&gt;&lt;p&gt;这个也需要换位思考，假设你是一个热心人，尝试帮助群上的人解答问题。是不是希望问题越准确越好？&lt;/p&gt;&#xA;&lt;p&gt;一些要点请备齐：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;软硬环境及版本&lt;/li&gt;&#xA;&lt;li&gt;操作步骤&lt;/li&gt;&#xA;&lt;li&gt;期待结果&lt;/li&gt;&#xA;&lt;li&gt;错误信息，最好是文本而不是截图&lt;/li&gt;&#xA;&lt;li&gt;设备运行的 log&lt;/li&gt;&#xA;&lt;li&gt;现场截图&lt;/li&gt;&#xA;&lt;li&gt;已尝试过的解决方案&lt;/li&gt;&#xA;&lt;li&gt;怀疑的点&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;重现问题的-demo&#34;&gt;&lt;a href=&#34;#%e9%87%8d%e7%8e%b0%e9%97%ae%e9%a2%98%e7%9a%84-demo&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;重现问题的 Demo&#xA;&lt;/h1&gt;&lt;ul&gt;&#xA;&lt;li&gt;创建你自己的 demo 程序，操作要友好&lt;/li&gt;&#xA;&lt;li&gt;加上使用说明，描述你所遇到的问题，具体环境，操作步骤，帮助别人快速重现你的问题&lt;/li&gt;&#xA;&lt;li&gt;打包你的 demo，上传到 github 或者百度云盘，让别人可以很快下载到&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;一个范例&#34;&gt;&lt;a href=&#34;#%e4%b8%80%e4%b8%aa%e8%8c%83%e4%be%8b&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;一个范例&#xA;&lt;/h1&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://stackoverflow.com/questions/34804039/android-testing-of-the-floating-view&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;stack-overflow&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;总结&#34;&gt;&lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;header-anchor&#34;&gt;&lt;/a&gt;总结&#xA;&lt;/h1&gt;&lt;p&gt;提问技巧，也是属于沟通技巧之一。&lt;/p&gt;&#xA;&lt;p&gt;笔者认为要达到有效的沟通，双方都需要有同理心，要换位思考。&lt;/p&gt;&#xA;&lt;p&gt;愿这篇文章能为大家带来一些启发，能够收获更多满意的答案。&lt;/p&gt;&#xA;</description>
        </item></channel>
</rss>
